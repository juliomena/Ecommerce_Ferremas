<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ferreteria Ferremas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <style>
    header, footer {
      background-color: #3209eb;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }
    table {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Ferreteria Ferremas</h1>
  </header>
  <div class="container my-4">
    <h2>Listado de Clientes</h2>
    <!-- Formulario de alta/modificación -->
    <form id="clienteForm" class="mb-4">
      <input type="hidden" id="clienteId">
      <div class="row g-2">
        <div class="col"><input type="text" class="form-control" id="name" placeholder="Nombre" required></div>
        <div class="col"><input type="text" class="form-control" id="lastName" placeholder="Apellido" required></div>
        <div class="col"><input type="email" class="form-control" id="email" placeholder="Email" required></div>
        <div class="col"><input type="text" class="form-control" id="direccion" placeholder="Dirección" required></div>
        <div class="col"><input type="text" class="form-control" id="telefono" placeholder="Teléfono" required></div>
        <div class="col"><input type="text" class="form-control" id="username" placeholder="Username" required></div>
        <div class="col"><input type="password" class="form-control" id="password" placeholder="Password" required></div>
        <div class="col">
          <button type="submit" class="btn btn-success" id="btnGuardar">Guardar</button>
          <button type="button" class="btn btn-secondary" id="btnCancelar" style="display:none;">Cancelar</button>
        </div>
      </div>
    </form>
    <table class="table table-striped table-bordered">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Apellido</th>
          <th>Email</th>
          <th>Dirección</th>
          <th>Teléfono</th>
          <th>Username</th>
          <th>Password</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="tabla-clientes">
        <!-- Se llenará con jQuery -->
      </tbody>
    </table>
  </div>
  <footer>
    <p>&copy; Grupo <b>FSJ</b> - 2025</p>
  </footer>
  <script>
    const apiUrl = "http://localhost:8082/customers";

    function cargarClientes() {
      $.get(apiUrl, function(data) {
        $('#tabla-clientes').empty();
        data.forEach(function(cliente) {
          $('#tabla-clientes').append(`
            <tr>
              <td>${cliente.id}</td>
              <td>${cliente.name}</td>
              <td>${cliente.lastName}</td>
              <td>${cliente.email}</td>
              <td>${cliente.direccion}</td>
              <td>${cliente.telefono}</td>
              <td>${cliente.username}</td>
              <td><input type="password" value="${cliente.password}" disabled></td>
              <td>
                <button class="btn btn-warning btn-sm btnEditar" data-id="${cliente.id}">Editar</button>
                <button class="btn btn-danger btn-sm btnEliminar" data-id="${cliente.id}">Eliminar</button>
              </td>
            </tr>
          `);
        });
      });
    }

    // Crear o actualizar cliente
    $('#clienteForm').submit(function(e) {
      e.preventDefault();
      const cliente = {
        id: $('#clienteId').val() || null,
        name: $('#name').val(),
        lastName: $('#lastName').val(),
        email: $('#email').val(),
        direccion: $('#direccion').val(),
        telefono: $('#telefono').val(),
        username: $('#username').val(),
        password: $('#password').val()
      };
      const method = cliente.id ? "POST" : "POST";
      $.ajax({
        url: apiUrl,
        method: method,
        contentType: "application/json",
        data: JSON.stringify(cliente),
        success: function() {
          cargarClientes();
          $('#clienteForm')[0].reset();
          $('#clienteId').val('');
          $('#btnGuardar').text('Guardar');
          $('#btnCancelar').hide();
        },
        error: function() {
          alert("Error al guardar el cliente.");
        }
      });
    });

    // Editar cliente
    $(document).on('click', '.btnEditar', function() {
      const id = $(this).data('id');
      $.get(apiUrl + '/' + id, function(cliente) {
        $('#clienteId').val(cliente.id);
        $('#name').val(cliente.name);
        $('#lastName').val(cliente.lastName);
        $('#email').val(cliente.email);
        $('#direccion').val(cliente.direccion);
        $('#telefono').val(cliente.telefono);
        $('#username').val(cliente.username);
        $('#password').val(cliente.password);
        $('#btnGuardar').text('Actualizar');
        $('#btnCancelar').show();
      });
    });

    // Cancelar edición
    $('#btnCancelar').click(function() {
      $('#clienteForm')[0].reset();
      $('#clienteId').val('');
      $('#btnGuardar').text('Guardar');
      $(this).hide();
    });

    // Eliminar cliente
    $(document).on('click', '.btnEliminar', function() {
      if (confirm("¿Seguro que deseas eliminar este cliente?")) {
        const id = $(this).data('id');
        $.ajax({
          url: apiUrl + '/' + id,
          method: 'DELETE',
          success: function() {
            cargarClientes();
          },
          error: function() {
            alert("Error al eliminar el cliente.");
          }
        });
      }
    });

    // Inicializar
    $(document).ready(function () {
      cargarClientes();
      $('#btnCancelar').hide();
    });
  </script>
</body>
</html>
