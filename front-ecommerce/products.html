<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ferretería Ferremas - Productos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <style>
    header, footer {
      background-color: #3209eb;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }
    table {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Ferretería Ferremas</h1>
  </header>
  <div class="container my-4">
    <h2>Listado de Productos</h2>
    <!-- Formulario de alta/modificación de producto -->
    <form id="productoForm" class="mb-4">
      <input type="hidden" id="idProducto">
      <div class="row g-2">
        <div class="col"><input type="text" class="form-control" id="nombre" placeholder="Nombre" required></div>
        <div class="col"><input type="text" class="form-control" id="descripcion" placeholder="Descripción" required></div>
        <div class="col"><input type="number" class="form-control" id="precio" placeholder="Precio" required></div>
        <div class="col"><input type="number" class="form-control" id="stock" placeholder="Stock" required></div>
        <div class="col">
          <button type="submit" class="btn btn-success" id="btnGuardarProducto">Guardar</button>
          <button type="button" class="btn btn-secondary" id="btnCancelarProducto" style="display:none;">Cancelar</button>
        </div>
      </div>
    </form>
    <table class="table table-striped table-bordered">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Descripción</th>
          <th>Precio</th>
          <th>Stock</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="tabla-productos">
        <!-- Se llenará con jQuery -->
      </tbody>
    </table>
  </div>
  <footer>
    <p>&copy; Grupo <b>FSJ</b> - 2025</p>
  </footer>
  <script>
    const apiUrl = "http://localhost:8182/products";

    function cargarProductos() {
      $.get(apiUrl, function(data) {
        $('#tabla-productos').empty();
        data.forEach(function(producto) {
          $('#tabla-productos').append(`
            <tr>
              <td>${producto.idProducto}</td>
              <td>${producto.nombre}</td>
              <td>${producto.descripcion}</td>
              <td>${producto.precio}</td>
              <td>${producto.stock}</td>
              <td>
                <button class="btn btn-warning btn-sm btnEditarProducto" data-id="${producto.idProducto}">Editar</button>
                <button class="btn btn-danger btn-sm btnEliminarProducto" data-id="${producto.idProducto}">Eliminar</button>
              </td>
            </tr>
          `);
        });
      });
    }

    // Crear o actualizar producto
    $('#productoForm').submit(function(e) {
      e.preventDefault();
      const producto = {
        idProducto: $('#idProducto').val() || null,
        nombre: $('#nombre').val(),
        descripcion: $('#descripcion').val(),
        precio: $('#precio').val(),
        stock: $('#stock').val()
      };
      const method = producto.id ? "POST" : "POST";
      $.ajax({
        url: apiUrl,
        method: method,
        contentType: "application/json",
        data: JSON.stringify(producto),
        success: function() {
          cargarProductos();
          $('#productoForm')[0].reset();
          $('#idProducto').val('');
          $('#btnGuardarProducto').text('Guardar');
          $('#btnCancelarProducto').hide();
        },
        error: function() {
          alert("Error al guardar el producto.");
        }
      });
    });

    // Editar producto
    $(document).on('click', '.btnEditarProducto', function() {
      const id = $(this).data('id');
      $.get(apiUrl + '/' + id, function(producto) {
        $('#idProducto').val(producto.idProducto);
        $('#nombre').val(producto.nombre);
        $('#descripcion').val(producto.descripcion);
        $('#precio').val(producto.precio);
        $('#stock').val(producto.stock);
        $('#btnGuardarProducto').text('Actualizar');
        $('#btnCancelarProducto').show();
      });
    });

    // Cancelar edición
    $('#btnCancelarProducto').click(function() {
      $('#productoForm')[0].reset();
      $('#idProducto').val('');
      $('#btnGuardarProducto').text('Guardar');
      $(this).hide();
    });

    // Eliminar producto
    $(document).on('click', '.btnEliminarProducto', function() {
      if (confirm("¿Seguro que deseas eliminar este producto?")) {
        const id = $(this).data('id');
        $.ajax({
          url: apiUrl + '/' + id,
          method: 'DELETE',
          success: function() {
            cargarProductos();
          },
          error: function() {
            alert("Error al eliminar el producto.");
          }
        });
      }
    });

    // Inicializar
    $(document).ready(function () {
      cargarProductos();
      $('#btnCancelarProducto').hide();
    });
  </script>
</body>
</html>
